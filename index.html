<!doctype html>
<!--
 @license
 Copyright 2019 Google LLC. All Rights Reserved.
 SPDX-License-Identifier: Apache-2.0
-->
<html>

<head>
  <title>Restaurants Map</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
  <style>
    /* Add some styles to make the map and input fields look nice */
    #map {
      height: 90vh;
      width: 100%;
    }

    #input-form {
      margin: 1vh;
    }
  </style>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyATP24qMF8uxs4eGE6pa_JoWZvmotvFa_Y&libraries=places&v=weekly"></script>
</head>

<body>
  <div id="input-form">
    <label for="beer-price">Price of a Beer:</label>
    <input type="text" id="beer-price" placeholder="Enter price" />
    <button id="updatePriceBtn">Update Price</button>
  </div>
  <div id="map"></div>

  <script>
    let map;
    let service;
    let infowindow;
    let selectedMarker = null;
    const markers = [];

    function initMap() {
      // Initialize the map centered at a default location
      const defaultLocation = new google.maps.LatLng(52.3676, 4.9041);

      map = new google.maps.Map(document.getElementById("map"), {
        center: defaultLocation,
        zoom: 14,
      });

      infowindow = new google.maps.InfoWindow();

      document
        .getElementById("updatePriceBtn")
        .addEventListener("click", updateBeerPrice);
    }

    function searchRestaurants(location) {
      const request = {
        location: location,
        radius: "500",
        type: ["restaurant"],
      };

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, (results, status) => {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          for (let i = 0; i < results.length; i++) {
            createMarker(results[i]);
          }
        }
      });
    }

    function createMarker(place) {
      const icon = {
        url: place.icon,
        scaledSize: new google.maps.Size(30, 30),
      };

      const marker = new google.maps.Marker({
        map,
        position: place.geometry.location,
        icon: icon,
      });

      marker.place = place;
      marker.beerPrice = null; // Initialize beer price as null
      markers.push(marker);

      google.maps.event.addListener(marker, "click", () => {
        selectedMarker = marker;
        const content = `<div><strong>${place.name}</strong><br>${place.vicinity}</div>`;
        infowindow.setContent(content);
        infowindow.open(map, marker);
      });
    }

    function updateBeerPrice() {
      if (selectedMarker) {
        const beerPrice = document.getElementById("beer-price").value;
        if (beerPrice && !isNaN(beerPrice)) {
          selectedMarker.beerPrice = beerPrice;
          const content = `
              <div><strong>${selectedMarker.place.name}</strong><br>
              ${selectedMarker.place.vicinity}<br>
              Beer Price: $${beerPrice}</div>`;
          infowindow.setContent(content);
          infowindow.open(map, selectedMarker);
        } else {
          alert("Please enter a valid price.");
        }
      } else {
        alert("Please select a marker first.");
      }
    }

    window.onload = initMap;
  </script>
</body>

</html>